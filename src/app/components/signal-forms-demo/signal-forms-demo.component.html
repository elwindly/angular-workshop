<mat-card>
  <mat-card-header>
    <mat-card-title>Signal Forms Demo - Angular 21</mat-card-title>
    <mat-card-subtitle>Signal Forms with 7 Fields and Various Validations</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    @if (!formSubmitted()) {
      <form (submit)="onSubmit()" class="form-container">
        <!-- 1. Username with async validation -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Username</mat-label>
          <input matInput [field]="signalUserForm.username" placeholder="Enter unique username" />
          <mat-hint align="end"
            >Min 3 characters. Try 'admin' or 'test' to see async validation.</mat-hint
          >
          @if (signalUserForm.username().pending()) {
            <mat-hint class="checking">Checking availability...</mat-hint>
          }
          @if (signalUserForm.username().invalid() && signalUserForm.username().touched()) {
            @for (usernameErrors of signalUserForm.username().errors(); track usernameErrors) {
              <mat-error>{{ usernameErrors.message }}</mat-error>
            }
          }
        </mat-form-field>

        <!-- 2. Email -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Email</mat-label>
          <input
            matInput
            type="email"
            [field]="signalUserForm.email"
            placeholder="your@email.com"
          />
          @if (signalUserForm.email().invalid() && signalUserForm.email().touched()) {
            @for (emailErrors of signalUserForm.email().errors(); track emailErrors) {
              <mat-error>{{ emailErrors.message }}</mat-error>
            }
          }
        </mat-form-field>

        <!-- 3. Age -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Age</mat-label>
          <input matInput type="number" [field]="signalUserForm.age" placeholder="18-120" />
          <mat-hint>Must be between 18 and 120</mat-hint>
          @if (signalUserForm.age().invalid() && signalUserForm.age().touched()) {
            @for (ageErrors of signalUserForm.age().errors(); track ageErrors) {
              <mat-error>{{ ageErrors.message }}</mat-error>
            }
          }
        </mat-form-field>

        <!-- 4. Country -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Country</mat-label>
          <mat-select [field]="signalUserForm.country" placeholder="Select your country">
            @for (country of countries; track country) {
              <mat-option [value]="country">{{ country }}</mat-option>
            }
          </mat-select>
          @if (signalUserForm.country().invalid() && signalUserForm.country().touched()) {
            @for (countryErrors of signalUserForm.country().errors(); track countryErrors) {
              <mat-error>{{ countryErrors.message }}</mat-error>
            }
          }
        </mat-form-field>

        <!-- 5. Bio with word count validation -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Bio</mat-label>
          <textarea
            matInput
            [field]="signalUserForm.bio"
            rows="4"
            placeholder="Tell us about yourself (10-100 words)"
          >
          </textarea>
          <mat-hint>10 to 100 words required</mat-hint>
          @if (signalUserForm.bio().invalid() && signalUserForm.bio().touched()) {
            @for (bioErrors of signalUserForm.bio().errors(); track bioErrors) {
              <mat-error>{{ bioErrors.message }}</mat-error>
            }
          }
        </mat-form-field>

        <!-- 6. Birth Date -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Birth Date</mat-label>
          <input
            matInput
            [matDatepicker]="picker"
            [field]="signalUserForm.birthDate"
            placeholder="MM/DD/YYYY"
          />
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          <mat-hint>Must be a date in the past</mat-hint>
          @if (signalUserForm.birthDate().invalid() && signalUserForm.birthDate().touched()) {
            @for (birthDateErrors of signalUserForm.birthDate().errors(); track birthDateErrors) {
              @for (birthDateErrors of signalUserForm.birthDate().errors(); track birthDateErrors) {
                <mat-error>{{ birthDateErrors.message }}</mat-error>
              }
            }
          }
        </mat-form-field>

        <!-- 7. Terms and Conditions -->
        <div class="checkbox-container">
          <mat-checkbox [field]="signalUserForm.termsAccepted">
            I accept the terms and conditions
          </mat-checkbox>
          @if (
            signalUserForm.termsAccepted().invalid() && signalUserForm.termsAccepted().touched()
          ) {
            <div class="checkbox-error">You must accept the terms and conditions</div>
          }
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="signalUserForm().invalid"
          >
            Submit
          </button>
          <button mat-raised-button type="button" (click)="onReset()">Reset</button>
        </div>

        <!-- Form Status -->
        <div class="form-status">
          <p>
            <strong>Form Status:</strong>
            {{ signalUserForm().valid() ? "Valid ✓" : "Invalid ✗" }}
          </p>
          <p>
            <strong>Form Touched:</strong>
            {{ signalUserForm().touched() ? "Yes" : "No" }}
          </p>
        </div>
      </form>
    } @else {
      <!-- Success Message -->
      <div class="success-container">
        <h2>Form Submitted Successfully! ✓</h2>
        <div class="submitted-data">
          <h3>Submitted Data:</h3>
          <pre>{{ formData() | json }}</pre>
        </div>
        <button mat-raised-button color="accent" (click)="onReset()">Submit Another Form</button>
      </div>
    }
  </mat-card-content>
</mat-card>
